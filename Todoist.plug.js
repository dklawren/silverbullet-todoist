var E=Object.defineProperty;var a=(e,r)=>{for(var n in r)E(e,n,{get:r[n],enumerable:!0})};var g=typeof window>"u"&&typeof globalThis.WebSocketPair>"u";typeof Deno>"u"&&(self.Deno={args:[],build:{arch:"x86_64"},env:{get(){}}});var f=new Map,m=0;function d(e){self.postMessage(e)}g&&(globalThis.syscall=async(e,...r)=>await new Promise((n,o)=>{m++,f.set(m,{resolve:n,reject:o}),d({type:"sys",id:m,name:e,args:r})}));function T(e,r){g&&(self.addEventListener("message",n=>{(async()=>{let o=n.data;switch(o.type){case"inv":{let i=e[o.name];if(!i)throw new Error(`Function not loaded: ${o.name}`);try{let s=await Promise.resolve(i(...o.args||[]));d({type:"invr",id:o.id,result:s})}catch(s){console.error("An exception was thrown as a result of invoking function",o.name,"error:",s.message),d({type:"invr",id:o.id,error:s.message})}}break;case"sysr":{let i=o.id,s=f.get(i);if(!s)throw Error("Invalid request id");f.delete(i),o.error?s.reject(new Error(o.error)):s.resolve(o.result)}break}})().catch(console.error)}),d({type:"manifest",manifest:r}))}function R(e){let r=atob(e),n=r.length,o=new Uint8Array(n);for(let i=0;i<n;i++)o[i]=r.charCodeAt(i);return o}function b(e){typeof e=="string"&&(e=new TextEncoder().encode(e));let r="",n=e.byteLength;for(let o=0;o<n;o++)r+=String.fromCharCode(e[o]);return btoa(r)}async function N(e,r){if(typeof e!="string"){let n=new Uint8Array(await e.arrayBuffer()),o=n.length>0?b(n):void 0;r={method:e.method,headers:Object.fromEntries(e.headers.entries()),base64Body:o},e=e.url}return syscall("sandboxFetch.fetch",e,r)}globalThis.nativeFetch=globalThis.fetch;function O(){globalThis.fetch=async function(e,r){let n=r&&r.body?b(new Uint8Array(await new Response(r.body).arrayBuffer())):void 0,o=await N(e,r&&{method:r.method,headers:r.headers,base64Body:n});return new Response(o.base64Body?R(o.base64Body):null,{status:o.status,headers:o.headers})}}g&&O();typeof self>"u"&&(self={syscall:()=>{throw new Error("Not implemented here")}});function w(e,...r){return globalThis.syscall(e,...r)}function P(e,r="info"){return w("editor.flashNotification",e,r)}typeof self>"u"&&(self={syscall:()=>{throw new Error("Not implemented here")}});function t(e,...r){return globalThis.syscall(e,...r)}var u={};a(u,{parseMarkdown:()=>L,renderParseTree:()=>D});function L(e){return t("markdown.parseMarkdown",e)}function D(e){return t("markdown.renderParseTree",e)}var c={};a(c,{deleteAttachment:()=>_,deleteFile:()=>Z,deletePage:()=>I,getAttachmentMeta:()=>$,getFileMeta:()=>J,getPageMeta:()=>q,listAttachments:()=>Y,listFiles:()=>V,listPages:()=>B,listPlugs:()=>Q,readAttachment:()=>H,readFile:()=>z,readPage:()=>W,writeAttachment:()=>G,writeFile:()=>X,writePage:()=>j});function B(){return t("space.listPages")}function q(e){return t("space.getPageMeta",e)}function W(e){return t("space.readPage",e)}function j(e,r){return t("space.writePage",e,r)}function I(e){return t("space.deletePage",e)}function Q(){return t("space.listPlugs")}function Y(){return t("space.listAttachments")}function $(e){return t("space.getAttachmentMeta",e)}function H(e){return t("space.readAttachment",e)}function G(e,r){return t("space.writeAttachment",e,r)}function _(e){return t("space.deleteAttachment",e)}function V(){return t("space.listFiles")}function z(e){return t("space.readFile",e)}function J(e){return t("space.getFileMeta",e)}function X(e,r){return t("space.writeFile",e,r)}function Z(e){return t("space.deleteFile",e)}var l={};a(l,{applyAttributeExtractors:()=>ie,getEnv:()=>ue,getMode:()=>ce,getSpaceConfig:()=>se,getVersion:()=>le,invokeCommand:()=>re,invokeFunction:()=>ee,invokeSpaceFunction:()=>ne,listCommands:()=>te,listSyscalls:()=>oe,reloadConfig:()=>de,reloadPlugs:()=>ae});function ee(e,...r){return t("system.invokeFunction",e,...r)}function re(e,r){return t("system.invokeCommand",e,r)}function te(){return t("system.listCommands")}function oe(){return t("system.listSyscalls")}function ne(e,...r){return t("system.invokeSpaceFunction",e,...r)}function ie(e,r,n){return t("system.applyAttributeExtractors",e,r,n)}async function se(e,r){return await t("system.getSpaceConfig",e)??r}function ae(){return t("system.reloadPlugs")}function de(){return t("system.reloadConfig")}function ue(){return t("system.getEnv")}function ce(){return t("system.getMode")}function le(){return t("system.getVersion")}var p={};a(p,{parse:()=>Te,stringify:()=>be});function Te(e){return t("yaml.parse",e)}function be(e){return t("yaml.stringify",e)}function y(e,r){if(r(e))return[e];let n=[];if(e.children)for(let o of e.children)n=[...n,...y(o,r)];return n}function x(e,r){return y(e,n=>n.type===r)[0]}function A(e,r){y(e,r)}async function Se(e,r){let n=await c.readPage(e),o=await u.parseMarkdown(n),i;return A(o,s=>{if(s.type!=="FencedCode")return!1;let h=x(s,"CodeInfo");if(r&&!h||r&&!r.includes(h.children[0].text))return!1;let v=x(s,"CodeText");return v?(i=v.children[0].text,!0):!1}),i}async function C(e,r=["yaml"]){let n=await Se(e,r);if(n!==void 0)try{return p.parse(n)}catch(o){throw console.error("YAML Page parser error",o),new Error(`YAML Error: ${o.message}`)}}async function S(e,r){try{return await l.getSpaceConfig(e)??r}catch{try{let o=(await C("SETTINGS")||{})[e];return o===void 0?r:o}catch(n){if(n.message==="Not found")return r;throw n}}}var Fe="todoist",Me={userCount:1};async function F(){let e={...Me,...await S(Fe,{})},r=1+Math.floor(Math.random()*e.userCount);console.log(e,r);let n=await fetch(`https://jsonplaceholder.typicode.com/users/${r}`);if(n.status<200||n.status>=300)throw new Error(await n.text());let o=await n.json();await P(o.name)}async function M(){await P("Adding task!")}var k={getTasks:F,addTask:M},U={name:"Todoist",requiredPermissions:["fetch"],functions:{getTasks:{path:"todoist.ts:getTasks",command:{name:"Todoist: Get Tasks"}},addTask:{path:"todoist.ts:addTask",command:{name:"Todoist: Add Task"}}},assets:{}},Pr={manifest:U,functionMapping:k};T(k,U);export{Pr as plug};
